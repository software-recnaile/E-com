<VirtualHost *:80>
    ServerName api.recnaile.com
    RewriteEngine On
    RewriteRule ^/?(.*) https://%{SERVER_NAME}/$1 [R=301,L]
</VirtualHost>

<VirtualHost *:443>
    ServerName api.recnaile.com

    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/api.recnaile.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/api.recnaile.com/privkey.pem
    Protocols h2 http/1.1
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"

    ProxyPreserveHost On
    ProxyRequests Off

    <Proxy *>
        Require all granted
    </Proxy>

    # --- Microservices ---
    ProxyPass        /auth/       http://authservice:8081/api/auth/
    ProxyPassReverse /auth/       http://authservice:8081/api/auth/

    ProxyPass        /account/    http://accountservice:8082/api/account/
    ProxyPassReverse /account/    http://accountservice:8082/api/account/

    ProxyPass        /product/    http://productservice:8083/api/product/
    ProxyPassReverse /product/    http://productservice:8083/api/product/

    ProxyPass        /cart/       http://cartservice:8084/api/cart/
    ProxyPassReverse /cart/       http://cartservice:8084/api/cart/

    ProxyPass        /wishlist/   http://wishlistservice:8085/api/wishlist/
    ProxyPassReverse /wishlist/   http://wishlistservice:8085/api/wishlist/

    ProxyPass        /profile/    http://profile:8086/api/profile/
    ProxyPassReverse /profile/    http://profile:8086/api/profile/

    ProxyPass        /bulkorder/  http://bulkorderservice:8087/api/bulkorder/
    ProxyPassReverse /bulkorder/  http://bulkorderservice:8087/api/bulkorder/

    ProxyPass        /address/    http://address:8088/api/address/
    ProxyPassReverse /address/    http://address:8088/api/address/

    ProxyPass        /mail/       http://mailservice:8089/api/mail/
    ProxyPassReverse /mail/       http://mailservice:8089/api/mail/

    <Location />
        Require all denied
    </Location>
</VirtualHost>
