version: "3.8"
dockerfile: Dockerfile
container_name: mail-service
restart: unless-stopped
environment:
- SPRING_PROFILES_ACTIVE=prod
- MONGODB_URI=${MONGODB_URI}
- SMTP_HOST=${SMTP_HOST}
- SMTP_PORT=${SMTP_PORT}
- SMTP_USER=${SMTP_USER}
- SMTP_PASS=${SMTP_PASS}
networks:
- webproxy


# ----------------------
# Nginx reverse proxy (exposes 80/443)
# ----------------------
nginx:
image: nginx:1.25-alpine
container_name: nginx-proxy
restart: unless-stopped
ports:
- "80:80"
- "443:443"
volumes:
- ./nginx/conf.d:/etc/nginx/conf.d:ro
- ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
- ./certbot/www:/var/www/certbot
- ./certbot/conf:/etc/letsencrypt
depends_on:
- auth-service
- account-service
- product-service
- cart-service
- wishlist-service
- profile-service
- bulkorder-service
- address-service
- mail-service
networks:
- webproxy


# ----------------------
# Certbot (Let's Encrypt) - runs only to create/renew certs using webroot
# ----------------------
certbot:
image: quay.io/letsencrypt/certbot:latest
container_name: certbot
volumes:
- ./certbot/www:/var/www/certbot
- ./certbot/conf:/etc/letsencrypt
entrypoint: "/bin/sh -c 'trap exit TERM; while :; do sleep 6h & wait $${!}; done'"
networks:
- webproxy


networks:
webproxy:
driver: bridge
